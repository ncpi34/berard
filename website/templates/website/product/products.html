{% extends "website/base.html" %}


{% block navbar %}
{% include "website/topnavbar.html" with sidenav=True %}
{% endblock %}

{% block content %}
    {% include 'website/modals/display_picture.html' %}
    {% include 'helpers/cart_button.html' %}
    {% load static %}
<style>
    @media screen and (min-width: 992px) {
       #img_navbar{
        margin-left: 310px!important;
        }
        main{
            margin-left: 310px!important;
        }
    }

    @media screen and (max-width: 992px) {
       #nav-icon1{
            display: block;
        }
        main{
            margin-left:0!important;
        }

    }
</style>
    <!--Main layout-->
<main class="mt-5" style="min-height: 83vh;">

    {% if articles %}
    <section class=" mb-4">
        <!--Grid row-->
        <div class="row justify-content-center wow fadeIn ">
           <!-- <div class="row wow fadeIn no-gutters"> -->
              {% for article in articles %}
          <!--Grid column-->
          <div class="articles col-lg-3 col-md-3 col-sm-6 mb-3 shadow-sm">

            <!--Card-->

            <div class="card medium" style="margin: -2%">
            
              <!--Card content-->
              <div class="card-body text-center">

                <!--Code & title-->
                <a href="{{ article.get_absolute_url }}">
                  <h6>{{ article.code_article }}</h6>
                  <h6>{{ article.libelle|title }}</h6>
                </a>
                <!--Code & title-->

                <!--Img-->  
                <a  href="#menu-modal" class="modal-trigger pic_button" id="{{ article.get_img }}"  >
                        <img class="rounded img_modal img-fluid ml-auto mr-auto card-img-top"
                             alt="photo" style="width: 50%;height: 8vw;object-fit: scale-down;"
                        src="{{ article.get_img }}"/>
                </a>
                <!--Img-->

                <!--Gencod-->
                  <a href="{{article.get_absolute_url}}">
                    <p style="font-size: 12px">{{ article.gencode }}</p>
                  </a>
                <!--Gencod-->
                {% if user.is_authenticated %}
                <!--Form-->  
                  <form action="{% url 'cart:cart_add' product_id=article.id %}" method="post"
                    class="d-flex justify-content-left small" style="margin-bottom: -20px">
                     {% csrf_token %}
                     <div class="row">
                       <div class="col">
                        Qté: {{ form }}
                       </div>
                       <div class="col">
                        <button class="form-control shadow-lg btn btn-success btn_send" type="submit">
                          <i class="fas fa-cart-plus"></i>
                      </button>
                       </div>
                     </div>
                  </form>
                <!--Form-->
              {% endif %}
              <div class="row d-flex justify-content-center">
                <!--Hidden Group-->
                <input type="hidden" class="hidden_groups" value="{{ article.groupe }}"/>
                <!--Hidden Group-->
                <div class="col">
                  <h6>
                    <label>UV: </label>
                    <strong class='product_multiples' >
                      {% if article.conditionnement is None%}
                       /
                      {% else %}
                      {{ article.conditionnement }}
                  {% endif %}
                    </strong>
                </h6>
                </div>
                <!--Col-->
                <div class="col">
                  <h6>
                      {% if user.is_authenticated %}
                        <span class="badge badge-info" style="font-size: 18px;">
                              {% load website_extras %}
                              {{ request.session.tarif|without_taxes:article }}€
                        </span>
                      {% endif %}
                  </h6>
                  <label>TVA {{ article.format_VAT }} %</label>
                </div>
              </div>
              <!--Col-->
              </div>
              <!--Row-->
              {% if not user.is_authenticated %}
                <div class="alert alert-warning text-center" role="alert">
                        <a href="{% url 'website:login' %}">
                            Veuillez vous connecter
                        </a>
                    </div>
            {% endif %}
              
              <!--Card content-->

            </div>
            <!--Card-->

          </div>
          <!--Fourth column-->
              {% endfor %}

        </div>
        <!--Grid row-->
      </section>
      <!--Section: Products v.3-->
        {% else %}
            <div class="container text-center" style="min-height: 80vh; margin-top: 15%">
            <h4>Pas d'articles pour le moment ...</h4>
            </div>
        {% endif %}

 <!-- Pagination-->
        {% if is_paginated %}
            {% load proper_paginate %}
            {% load url_replace %}
            {% load proper_paginate %}
            {% load url_replace %}
            <ul class="bg-grey d-flex text-info justify-content-center d-inline ">
                {% if page_obj.number == 1 %}
                    <li class="disabled nav-item d-inline-flex text-info align-items-center mr-4 text-white"><span>⇤</span></li>
                {% else %}
                    <li><a class="block nav-item d-inline-flex text-info align-items-center mr-4 text-white"
                           href="?{% url_replace request 'page' 1 %}">⇤</a></li>
                {% endif %}
                {% if page_obj.has_previous %}
                    <li><a class="block nav-item d-inline-flex text-info align-items-center mr-4 text-white"
                           href="?{% url_replace request 'page' page_obj.previous_page_number %}">&laquo;</a></li>
                {% else %}
                    <li class="disabled nav-item d-inline-flex text-info align-items-center mr-4 text-white"><span>&laquo;</span></li>
                {% endif %}
                {% for i in paginator|proper_paginate:page_obj.number %}
                    {% if page_obj.number == i %}
                        <li class="block nav-item d-inline-flex text-dark align-items-center mr-4 text-white">
                            <span>{{ i }} <span class="sr-only">(current)</span></span></li>
                    {% else %}
                        <li><a class="block nav-item d-inline-flex text-info align-items-center mr-4 text-white"
                               href="?{% url_replace request 'page' i %}">{{ i }}</a></li>
                    {% endif %}
                {% endfor %}
                {% if page_obj.has_next %}
                    <li><a class="block nav-item d-inline-flex text-info align-items-center mr-4 text-white"
                           href="?{% url_replace request 'page' page_obj.next_page_number %}">&raquo;</a></li>
                {% else %}
                    <li class="disabled nav-item d-inline-flex text-info align-items-center mr-4 text-white"><span>&raquo;</span></li>
                {% endif %}
                {% if page_obj.number == paginator.num_pages %}
                    <li class="disabled nav-item d-inline-flex text-info align-items-center mr-4 text-white"><span>⇥</span></li>
                {% else %}
                    <li><a class="block nav-item d-inline-flex text-info align-items-center mr-4 text-white"
                           href="?{% url_replace request 'page' paginator.num_pages %}">⇥</a></li>
                {% endif %}
            </ul>
        {% endif %}
       <!-- Pagination-->
  </main>


{% endblock content %}

{% block extrascripts %}
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const nav_top = document.querySelector('#topnavbar-navigation')
      if(nav_top) nav_top.classList.add('right')
    })
  </script>  
<script src="{% static 'js/modalPicture.js'%}"></script>
<script src="{% static 'js/scroll_position_send_to_cart.js'%}"></script>
{% endblock extrascripts %}